<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工程建模与仿真平台</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:,">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛠️ 工程建模与仿真平台</h1>
            <p>AI驱动的自动化建模、仿真与分析</p>
        </div>

        <div class="main-layout">
            <div class="main-content">
                <!-- Input Section -->
                <div class="input-section">
                    <div class="input-group">
                        <label for="problem-input">📝 问题描述:</label>
                        <textarea id="problem-input" placeholder="请输入工程问题..."></textarea>
                    </div>
                    <div class="input-group">
                        <label>🔩 物理参数:</label>
                        <div id="parameters-container">
                            <!-- Parameter rows will be inserted here -->
                        </div>
                        <button class="add-btn" id="add-parameter-btn">+ 添加参数</button>
                    </div>
                    <div class="input-group">
                        <label for="csv-upload">📊 对比数据 (CSV):</label>
                        <input type="file" id="csv-upload" accept=".csv">
                    </div>
                    <div class="solve-container">
                        <button class="solve-btn" id="solve-button">🚀 开始建模与仿真</button>
                        <input type="text" id="optimization-goal" placeholder="（可选）输入优化目标，如：使最大挠度最小">
                    </div>
                </div>

                <!-- Verification Pipeline -->
                <div class="verification-pipeline">
                    <div class="pipeline-title">🔄 建模与仿真流程</div>
                    <div class="verification-steps">
        <div class="verification-step" id="main-step-1">
            <div class="step-number">1</div>
            <div class="step-label">物理建模</div>
        </div>
        <div class="verification-step" id="main-step-2">
            <div class="step-number">2</div>
            <div class="step-label">模型审查</div>
        </div>
        <div class="parallel-steps-container">
            <div class="verification-step" id="main-step-3">
                <div class="step-number">3</div>
                <div class="step-label">生成仿真脚本</div>
            </div>
            <div class="verification-step" id="main-step-4">
                <div class="step-number">4</div>
                <div class="step-label">执行仿真</div>
            </div>
        </div>
        <div class="verification-step" id="main-step-5">
            <div class="step-number">5</div>
            <div class="step-label">结果分析</div>
        </div>
        <div class="verification-step" id="main-step-6">
            <div class="step-number">6</div>
            <div class="step-label">综合报告</div>
        </div>
    </div>
                </div>
                
                <!-- Results Container -->
                <div id="results-container"></div>
            </div>

            <div class="control-panel">
                <!-- Verification Status -->
                <div class="config-section" id="status-panel">
                    <div class="config-title">📊 实时仿真状态</div>
                    <div class="status-grid">
                        <div class="status-item">
                            <div id="current-iteration">0</div>
                            <div class="status-label">当前步骤</div>
                        </div>
                        <div class="status-item">
                            <div id="consecutive-passes">0</div>
                            <div class="status-label">连续成功</div>
                        </div>
                        <div class="status-item">
                            <div id="total-errors">0</div>
                            <div class="status-label">发现问题</div>
                        </div>
                        <div class="status-item">
                            <div id="python-validations">0</div>
                            <div class="status-label">仿真次数</div>
                        </div>
                    </div>
                    <div class="error-log-display" id="error-log-display">
                        <div class="error-log-header">日志汇总:</div>
                        <div class="error-log-content" id="error-log-content">暂无日志</div>
                    </div>
                    <button class="stop-btn" id="stop-button" style="display: none; margin-top: 10px;">🛑 停止流程</button>
                    <div class="failure-reason-display" id="failure-reason-display">
                        <div class="failure-reason-header">最终失败原因:</div>
                        <div class="failure-reason-content" id="failure-reason-content"></div>
                    </div>
                </div>

                <!-- File Saving -->
                <div class="save-section">
                    <div class="config-title">💾 文件保存与报告</div>
                    <button class="config-btn" id="save-all-btn">📁 批量保存所有文件</button>
                    <button class="config-btn" id="export-data-btn">📊 导出验证数据</button>
                    <div class="config-group" style="margin-top: 15px;">
                        <label for="latex-document-type">LaTeX报告类型:</label>
                        <select id="latex-document-type">
                            <option value="article">Article (论文)</option>
                            <option value="beamer">Beamer (演示文稿)</option>
                        </select>
                    </div>
                    <button class="config-btn" id="generate-report-btn" style="background: #6f42c1;">📄 生成LaTeX报告</button>
                </div>
                
                <!-- AI Config -->
                <div class="config-section">
                    <div class="config-title">🤖 AI配置</div>
                    <div class="config-group">
                        <label for="api-provider">API提供商:</label>
                        <select id="api-provider">
                            <option value="deepseek">DeepSeek</option>
                            <option value="google">Google Gemini</option>
                            <option value="openai">OpenAI GPT-4</option>
                        </select>
                    </div>
                    <div class="config-group">
                        <label for="model-version">模型版本:</label>
                        <select id="model-version"></select>
                    </div>
                    <div class="config-group">
                        <label for="solver-preference">求解器偏好:</label>
                        <select id="solver-preference">
                            <option value="python">Python</option>
                            <option value="matlab">MATLAB</option>
                            <option value="abaqus">Abaqus</option>
                        </select>
                    </div>
                    <button class="config-btn" id="test-ai-btn">🔗 测试AI连接 <span class="status-indicator status-disconnected" id="ai-connection-status"></span></button>
                    <button class="config-btn" id="test-connection-btn">🔌 测试后端连接</button>
                </div>

                <!-- Verification Config -->
                <div class="config-section">
                    <div class="config-title">⚙️ 验证配置</div>
                    <div class="config-group">
                        <label for="max-iterations">最大迭代次数:</label>
                        <input type="number" id="max-iterations" value="8" min="3" max="15">
                    </div>
                    <div class="config-group">
                        <label for="consecutive-passes-config">连续通过要求:</label>
                        <input type="number" id="consecutive-passes-config" value="3" min="2" max="5">
                    </div>
                    <div class="config-group">
                        <label for="verification-rigor">验证严格度:</label>
                        <select id="verification-rigor">
                            <option value="strict">严格 (推荐)</option>
                            <option value="moderate">适中</option>
                            <option value="lenient">宽松</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/lib/jszip.min.js"></script>
    <script src="js/state/state.js?v=1.8"></script>
    <script src="js/utils/utils.js?v=1.8"></script>
    <script src="js/ui/ui.js?v=1.8"></script>
    <script src="js/api/api.js?v=1.8"></script>
    <script src="js/core/verification.js?v=1.8"></script>
    <script src="js/handlers/handlers.js?v=1.8"></script>
    <script src="js/parameters.js?v=1.8"></script>
    <script src="js/handlers.js?v=1.8"></script>
    <script src="js/main.js?v=1.8"></script>
</body>
</html>